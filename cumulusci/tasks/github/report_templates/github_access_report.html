<html>

<head>
  <link rel="stylesheet" href="https://archive-2_6_1.lightningdesignsystem.com/assets/styles/site.css">
  {% if link_style %}
  <link rel="stylesheet" href="cumulusci/tasks/github/report_templates/github_access_report.css">
  {% else %}
  <{{""}}style type="text/css"> {# Hide HTML element from VSCode #}
    {% include "github_access_report.css" %}
    </style>
    {% endif %}
</head>

<body>
  <div class="slds-text-longform">
    <h1 class="slds-text-heading_large">Github Access Report - {{ org.name }}</h1>
    <p>{{ now.__str__().split(".")[0] }}</p>
    <h2 class="slds-text-heading_large">Contents</h2>
    <ul>
      <li><a href="#methodology">Methodology</a>
      </li>
      <li><a href="#repos">Repositories</a>
        <ul class="slds-text-longform">
          {% for repo_name in repos.keys() %}
          <li><a href="#{{ repo_name }}">{{ repo_name }}</a>
            <ul>
              <li><a href="#{{ repo_name }}-teams">Teams</a></li>
              <li><a href="#{{ repo_name }}-users">Direct Users</a></li>
            </ul>
          </li>
          {% endfor %}
        </ul>
      </li>
      <li><a href="#members">Organization Members</a></li>
      <li><a href="#teams">Teams</a>
        <ul class="slds-text-longform">
          {% for team_name in teams.keys() %}
          <li><a href="#{{ team_name }}">{{ team_name }}</a>
            <ul>
              <li>Team Members</li>
              <li>Team Repositories</li>
            </ul>
          </li>
          {% endfor %}
        </ul>
      </li>
      <li><a href="#teams">Entities filtered out of this analysis</a>
        <ul class="slds-text-longform">
          <li><a href="#filtered-entities">{{ team_name }}</a>
            <ul>
              <li><a href="#filtered-repos">Repos</a></li>
              <li><a href="#filtered-users">Users</a></li>
              <li><a href="#filtered-teams">Teams</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>

    <hr />

    <div id="methodology">
      <h2 class="slds-text-heading_large">Methodology</h2>
      <p>Generated by <a href="{{script_url}}">{{ script_url }}</a></p>
      {% if mode!='prod'%}
      <p><b>This is a draft of the report generated in dev mode.</b></p>
      {% endif %}

      <p>All or the repositories listed are for products that are Generally Available
        or will be within the next quarter. Other repos are
        filtered out.
      </p>
      <p>All of the teams and individuals below have access to one of the relevant repos.</p>
      <p>Repositories attributed to teams are also filtered to just the list of GA products.</p>
    </div>

    <div id="repos">
      <h2 class="slds-text-heading_large">Repositories</h2>

      {% for repo_name, repo_info in repos.items() %}
      <h3 class="slds-text-heading_medium" id="{{ repo_name }}">{{ repo_name }}</h3>
      <h4 class="slds-text-heading_small" id="{{ repo_name }}-teams">Teams</h4>
      <table class="slds-table slds-table_bordered slds-table_cell-buffer qar-perms">
        <thead>
          <tr>
            <th>Name</th>
            <th>Read</th>
            <th>Write</th>
            <th>Admin</th>
          </tr>
        </thead>
        <tbody>
          {% for team_name, team_info in repo_info["teams"].items() %}
          <tr>
            <td>{{ team_name }}</td>
            <td>{{ check(team_info.read) }}</td>
            <td>{{ check(team_info.write) }}</td>
            <td>{{ check(team_info.admin) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <h4 class="slds-text-heading_small" id="{{ repo_name }}-users">Direct Users</h4>
      <table class="slds-table slds-table_bordered slds-table_cell-buffer qar-perms">
        <thead>
          <tr>
            <th>Name</th>
            <th>Read</th>
            <th>Write</th>
            <th>Admin</th>
          </tr>
        </thead>
        <tbody>
          {% for user_name, user_info in repo_info["users_direct"].items() %}
          <tr>
            <td>{{ user_name }}</td>
            <td>{{ check(user_info.read) }}</td>
            <td>{{ check(user_info.write) }}</td>
            <td>{{ check(user_info.admin) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endfor %}
    </div>

    <hr />
    <div id="members">
      <h2 class="slds-text-heading_large">Organization Members</h2>
      <table class="slds-table slds-table_bordered slds-table_cell-buffer qar-wide">
        <thead>
          <tr>
            <th>Username</th>
            <th>Admin</th>
            {% for field in extra_fields %}
            <th>{{field}}</th>
            {% endfor %}
            <th>Github Email</th>
          </tr>
        </thead>
        <tbody>
          {% for member_name, member_info in org_members.items() %}
          <tr>
            <td>{{ member_name }}</td>
            <td>{{ check(member_info.admin) }}</td>
            {% for field in extra_fields %}
            <th>{{member_info.get(field) or ""}}</th>
            {% endfor %}
            <td>{{ member_info["email"] or "" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <hr />
    <div id="teams">
      <h2 class="slds-text-heading_large">Teams</h2>
      {% for team_name, team_info in teams.items() %}
      <h3 class="slds-text-heading_medium" id="{{team_name}}">{{ team_name }}</h3>
      <h4 class="slds-text-heading_small" id="{{team_name}}-members">Team Members</h4>
      <table class="slds-table slds-table_bordered slds-table_cell-buffer qar-flag">
        <thead>
          <tr>
            <th>Name</th>
            <th>Maintainer</th>
          </tr>
        </thead>
        <tbody>
          {% for member_name, member_info in team_info.members.items() %}
          <tr>
            <td>{{ member_name }}</td>
            <td> {{check(member_info["maintainer"])}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <h4 class="slds-text-heading_small" id="{{team_name}}-repositories">Team Repositories</h4>
      <table class="slds-table slds-table_bordered slds-table_cell-buffer qar-perms">
        <thead>
          <tr>
            <th>Name</th>
            <th>Read</th>
            <th>Write</th>
            <th>Admin</th>
          </tr>
        </thead>
        <tbody>
          {% for repo_name, repo_info in team_info.repos.items() %}
          <tr>
            <td>{{ repo_name }}</td>
            <td>{{ check(repo_info.read) }}</td>
            <td>{{ check(repo_info.write) }}</td>
            <td>{{ check(repo_info.admin) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% endfor %}
    </div>

    <hr />

    <div class="slds-text-longform" id="filtered-entities">
      <h2 class="slds-text-heading_large">Entities filtered out of this analysis</h2>

      <div id="filtered-repos">
        <h3 class="slds-text-heading_medium">Repos</h3>
        <p>Filtered because they are not GA products nor build-relevant:</p>
        <ul>{% for name in ignored["repos"] %}<li>{{name}}</li>{% endfor %}</ul>
      </div>

      <div id="filtered-users">
        <h3 class="slds-text-heading_medium">Users</h3>
        <p>Filtered because they cannot access the relevant repos:</p>
        <ul>{% for name in ignored["users"] %}<li>{{name}}</li>{% endfor %}</ul>
      </div>

      <div id="filtered-teams">
        <h3 class="slds-text-heading_medium">Teams</h3>
        <p>Filtered because they cannot read the relevant repos:</p>
        <ul>{% for name in ignored["teams"] %}<li>{{name}}</li>{% endfor %}</ul>
      </div>
    </div>
  </div>
</body>

</html>